<!DOCTYPE html>
<html data-bs-theme="light">
<!-- <html data-bs-theme="dark"> -->

<head>
    <meta charset="UTF-8" />
    <!--é€‚é…æ‰‹æœº-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åå°ç®¡ç†</title>
    <link rel="stylesheet" href="./assets/css/toastui-editor.min.css" />
    <link rel="stylesheet" href="./assets/css/toastui-editor-dark.css" />
    <link rel="stylesheet" href="./assets/css/prism.min.css" />
    <link rel="stylesheet" href="./assets/css/toastui-editor-plugin-code-syntax-highlight.min.css" />
    <link rel="stylesheet" href="./assets/css/tui-color-picker.min.css" />
    <link rel="stylesheet" href="./assets/css/toastui-editor-plugin-color-syntax.min.css" />
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
    <style>
        html,
        body {
            padding: 0.3rem;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .fade:not(.show) {
            display: none !important;
        }

        .modal-footer {
            border-top: none;
        }



        .toastui-editor-dropdown-toolbar {
            width: 100% !important;
            overflow-y: hidden !important;
            height: 55px !important;
            right: 0px !important;
        }

        .toastui-editor-defaultUI {
            border: 1px solid var(--bs-border-color) !important;
        }

        .toastui-editor-mode-switch {
            background-color: var(--bs-tertiary-bg) !important;
            border-top: 1px solid var(--bs-border-color) !important;
        }



        .form-check-input,
        .form-check-label {
            cursor: pointer;
        }

        #file-box2 {
            border: 2px dashed #efefef;
        }

        #file-box2:hover {
            border: 2px dashed #0097dfcc;
            background-color: #67ccff1f;
        }

        #img_list_box {
            height: 50px;
            overflow-y: hidden;
        }

        #img_list_box::-webkit-scrollbar,
        #recent_img_list_box::-webkit-scrollbar {
            height: 8px;
        }

        #img_list_box::-webkit-scrollbar-thumb,
        #recent_img_list_box::-webkit-scrollbar-thumb {
            border-radius: 10px;
            background-color: #6e6e6e73;
        }

        .zoomed {
            z-index: 987 !important;
            width: 100% !important;
            height: 100% !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            padding: 1% !important;
        }

        .loader {
            width: 50px;
            aspect-ratio: 1;
            display: grid;
            border: 4px solid #0000;
            border-radius: 50%;
            border-right-color: #25b09b;
            animation: l15 1s infinite linear;
            margin: 10% auto;
        }

        .loader::before,
        .loader::after {
            content: "";
            grid-area: 1/1;
            margin: 2px;
            border: inherit;
            border-radius: 50%;
            animation: l15 2s infinite;
        }

        .loader::after {
            margin: 8px;
            animation-duration: 3s;
        }

        @keyframes l15 {
            100% {
                transform: rotate(1turn)
            }
        }

        .AB,
        .f_btn {
            /* visibility: hidden; */
            opacity: 0;
        }

        .AB:hover,
        .f_btn:hover {
            /* visibility: visible; */
            opacity: 1;
        }

        #tc_content_box,
        .scrollbar-box {
            overflow-y: auto;
            height: 500px;
        }

        #tc_content_box::-webkit-scrollbar,
        .scrollbar-box::-webkit-scrollbar,
        #tuchuang_box::-webkit-scrollbar,
        #home_content::-webkit-scrollbar {
            width: 8px;

        }

        #tc_content_box::-webkit-scrollbar-thumb,
        .scrollbar-box::-webkit-scrollbar-thumb,
        #tuchuang_box::-webkit-scrollbar,
        #home_content::-webkit-scrollbar {
            border-radius: 10px;
            background-color: #ced4da6e;
        }

        #recent_img_list_box {
            background-color: rgba(0, 0, 0, 0.082);
        }

        .post_item {
            transition: all 0.3s;
        }

        .post_item:hover {
            transform: scale(1.02);
            margin: 0;
            border: var(--bs-tertiary-bg) !important;
        }

        .edit_btn {
            transition: all 0.3s;
        }

        .edit_btn:hover {
            transform: scale(1.1);
        }




        /* å®šä¹‰å…³é”®å¸§åŠ¨ç”» */
        @keyframes breathingEffect {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .breathing {
            animation: breathingEffect 1.5s ease-in-out infinite;
            will-change: opacity;
        }

        .accordion-button:not(.collapsed) {
            background-color: #00000000 !important;
        }
    </style>
</head>

<body class="d-flex flex-column align-items-center ">
    <script src="./assets/js/toastui-editor-all.min.js"></script>
    <script src="./assets/js/zh-cn.js"></script>
    <script src="./assets/js/toastui-editor-plugin-code-syntax-highlight-all.min.js"></script>
    <script src="./assets/js/tui-color-picker.min.js"></script>
    <script src="./assets/js/toastui-editor-plugin-color-syntax.min.js"></script>
    <script src="./assets/js/bootstrap.bundle.min.js"></script>

    <!-- æç¤ºæ¡† -->
    <div id="liveAlertPlaceholder" class="show position-absolute start-0 w-100 p-2" style="z-index: 999;"></div>



    <!-- ç•Œé¢ -->
    <div class="w-100 h-100 p-3 m-0 d-flex ">

        <!-- å·¦ä¾§ -->
        <div class="border rounded me-2 w-25 p-2 flex-column align-items-center overflow-auto"
            style="display: none;overflow-x: hidden !important;" id="tuchuang_box">
            <div id="recent_img_list_box" class="rounded d-flex w-100 p-1 m-1 overflow-x-auto"></div>
            <div class="w-100 flex-fill mb-2 d-flex flex-column align-items-center justify-content-center">
                <div class="w-100">
                    <button type="button" class="btn btn-primary" id="update_img">åˆ·æ–°</button>
                </div>
                <div class="accordion accordion-flush flex-fill w-100" id="tc_content_box"></div>
            </div>
            <div class="w-100 d-flex flex-column align-items-center justify-content-center" style="height: 20%;">
                <div class="w-100 m-1 p-2 rounded" id="preview_box"
                    style="display: flex;background: rgba(0, 0, 0, 0.082);">
                    <div class="d-flex flex-fill" id="img_list_box"></div>
                    <button type="button"
                        class="btn btn-primary ms-2 d-flex align-items-center justify-content-center h-100"
                        style="width: 50px;" id="uploadimg"><span style="font-size: 0.6rem;">ä¸Šä¼ </span></button>
                </div>
                <div class="rounded w-100 flex-fill d-flex flex-column align-items-center justify-content-center position-relative"
                    id="file-box2">
                    <span class="w-100 position-absolute text-center">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤æˆ–è€…ç‚¹å‡»ä¸Šä¼ </span>
                    <input type="file" id="image_input" onchange="toBase64()"
                        accept="image/jpeg,image/png,image/jpg,image/gif" multiple style="cursor: pointer;"
                        class="opacity-0 w-100 h-100" />

                </div>
            </div>
        </div>

        <!-- å³ä¾§ -->
        <div class="w-100 h-100 p-3 m-0 d-flex flex-column border rounded">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="myTabs" role="tablist">
                <li class="nav-item " role="presentation">
                    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#_home"
                        type="button" role="tab" aria-controls="_home" aria-selected="true">ğŸ ï¸ä¸»é¡µ</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="w_blog-tab" data-bs-toggle="tab" data-bs-target="#w_blog" type="button"
                        role="tab" aria-controls="w_blog" aria-selected="true">ğŸ“å†™æ–‡ç« </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#_settings"
                        type="button" role="tab" aria-controls="_settings" aria-selected="false">âš™ï¸è®¾ç½®</button>
                </li>
                <li class="nav-item d-flex align-items-center justify-content-center" role="presentation">
                    <div class="form-check form-switch m-0 ms-3">
                        <input class="form-check-input" type="checkbox" role="switch" id="tuchuang">
                        <label class="form-check-label" for="tuchuang">ğŸ–¼ï¸å›¾åºŠ</label>
                    </div>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content flex-fill d-flex flex-column position-relative">
                <div class="tab-pane fade show active  position-absolute w-100 h-100 d-flex flex-column align-items-center justify-content-center"
                    id="_home" role="tabpanel" aria-labelledby="home-tab">
                    <div style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;display: none;flex-direction: column;align-items: center;justify-content: center;background: #0000005e;z-index: 666;transition: all 1s;opacity:0;"
                        id="del_msbox">
                        <div id="del_msbox2"
                            style="width: 100%;height: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;position: fixed;bottom: 100%;left: 0;transition: all 0.6s ease 0s;">
                            <div
                                style="background: var(--bs-tertiary-bg);padding: 30px 30px 10px 30px;border-radius: 5px;width: 250px;display: flex;flex-direction: column;align-items: center;justify-content: center;">
                                (á½¸â¸ÏŒ)âœ§ æ˜¯å¦åˆ é™¤æ–‡ç« ï¼Ÿ
                                <div style="margin-top: 25px;">
                                    <button type="button" class="btn btn-secondary m-2" id="c_del">å–æ¶ˆ</button>
                                    <button type="button" class="btn btn-danger m-2" id="e_del">åˆ é™¤</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-column align-items-center justify-content-center " id="no_set"
                        style="display: none;">
                        <p id="ptext"></p>
                        <button type="button" class="btn btn-outline-primary" id="set_info">è®¾ç½®</button>
                    </div>
                    <div class="w-100 h-100 flex-column" id="post_box" style="display: none;">
                        <button type="button" id="load_post" class="btn btn-primary m-2">
                            åŠ è½½æ–‡ç« 
                        </button>
                        <div class="flex-fill overflow-y-auto overflow-x-hidden" id="home_content">
                        </div>
                        <span id="postlist_changedate"
                            style="font-size: 0.5rem;width: 100%;text-align: right;position: fixed;right: 25px;bottom: 5px;"></span>
                    </div>
                </div>

                <div class="tab-pane fade flex-fill d-flex position-absolute w-100 h-100" id="w_blog" role="tabpanel"
                    aria-labelledby="w_blog-tab">

                    <div class=" d-flex flex-column w-100 h-100 flex-fill">
                        <div id="title_box" class="d-flex flex-column mb-2">
                            <div class="accordion accordion-flush" id="wenzhang0">
                                <div class="accordion-item">
                                    <div class="accordion-header" id="wenzhang1">
                                        <button class="accordion-button collapsed p-2 rounded" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#wenzhang2" aria-expanded="false"
                                            aria-controls="wenzhang2">
                                            æ–‡ç« è®¾ç½®
                                        </button>
                                    </div>
                                    <div id="wenzhang2" class="accordion-collapse collapse" aria-labelledby="wenzhang1"
                                        data-bs-parent="#wenzhang0">
                                        <div class="accordion-body">
                                            <div class="mb-2 mt-2">
                                                <input type="text" class="form-control" id="post_title"
                                                    placeholder="æ–‡ç« æ ‡é¢˜">
                                            </div>
                                            <div class="mb-2">
                                                <textarea class="form-control" id="post_description"
                                                    placeholder="æ–‡ç« æè¿°ã€‚ä¸ºç©ºæ—¶ä¼šè‡ªåŠ¨æ‘˜å–æ–‡ç« å¼€å¤´å†…å®¹" rows="3"></textarea>
                                            </div>
                                            <div class="input-group mb-2">
                                                <input type="text" class="form-control" id="post_categories"
                                                    placeholder="åˆ†ç±» æœ€å¤š2ä¸ªï¼Œé€—å·åˆ†éš”">
                                                <span class="input-group-text"></span>
                                                <input type="text" class="form-control" id="post_tag"
                                                    placeholder="æ ‡ç­¾ æ”¯æŒå¤šä¸ªï¼Œé€—å·åˆ†éš”">
                                            </div>
                                            <div class="input-group mb-2">
                                                <input type="text" class="form-control" id="post_img"
                                                    placeholder="å°é¢å›¾é“¾æ¥">
                                                <span class="input-group-text"></span>
                                                <input type="text" class="form-control" id="post_img_alt"
                                                    placeholder="å°é¢æè¿°">
                                            </div>

                                            <div class="d-flex justify-content-end">
                                                <div class="form-check form-switch me-2">
                                                    <input class="form-check-input" type="checkbox" role="switch"
                                                        id="zhiding">
                                                    <label class="form-check-label" for="zhiding">ç½®é¡¶æ–‡ç« </label>
                                                </div>
                                                <div class="form-check form-switch me-2">
                                                    <input class="form-check-input" type="checkbox" role="switch"
                                                        id="shuxue">
                                                    <label class="form-check-label" for="shuxue">æ•°å­¦å‡½æ•°</label>
                                                </div>
                                                <div class="form-check form-switch me-2">
                                                    <input class="form-check-input" type="checkbox" role="switch"
                                                        id="tubiao">
                                                    <label class="form-check-label" for="tubiao">æ¸²æŸ“å›¾è¡¨</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div id="editor" class="flex-fill"></div>
                        <div class="d-flex justify-content-center">
                            <div style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;display: none;flex-direction: column;align-items: center;justify-content: center;background: #0000005e;z-index: 666;transition: all 1s;opacity:0;"
                                id="post_msbox">
                                <div id="post_msbox2"
                                    style="width: 100%;height: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;position: fixed;bottom: 100%;left: 0;transition: all 0.6s ease 0s;">
                                    <div
                                        style="background: var(--bs-tertiary-bg);padding: 30px 30px 10px 30px;border-radius: 5px;width: 250px;display: flex;flex-direction: column;align-items: center;justify-content: center;">
                                        Æª(â€¢ÌƒÍ¡â€¢ÌƒÍ¡ Æª æ˜¯å¦å‘å¸ƒæ–‡ç« ï¼Ÿ
                                        <div style="margin-top: 25px;">
                                            <button type="button" class="btn btn-secondary m-2" id="c_post">å–æ¶ˆ</button>
                                            <button type="button" class="btn btn-primary m-2" id="e_post">å‘å¸ƒ</button>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <button type="button" class="btn btn-success w-25 m-4" id="_post">å‘å¸ƒæ–‡ç« </button>
                            <button type="button" class="btn btn-primary w-25 m-4" id="_post2"
                                style="display: none;">å‘å¸ƒä¿®æ”¹æ–‡ç« </button>
                        </div>
                    </div>

                </div>

                <div class="tab-pane fade flex-fill position-absolute w-100 h-100 d-flex flex-column align-items-center justify-content-center"
                    id="_settings" role="tabpanel" aria-labelledby="settings-tab">
                    <div class="border rounded p-5 d-flex flex-column align-items-center justify-content-center">
                        <span class="mb-2">åŸºç¡€è®¾ç½®</span>
                        <div class="input-group mb-3">
                            <span class="input-group-text">https://github.com/</span>
                            <input type="text" class="form-control" id="owner_" placeholder="æ‹¥æœ‰è€…"
                                aria-label="ownername">
                            <span class="input-group-text">/</span>
                            <input type="text" class="form-control" id="repo_" placeholder="ä»“åº“å" aria-label="reponame">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text">æäº¤è€…</span>
                            <input type="text" class="form-control" id="name_" placeholder="githubè´¦æˆ·çš„name"
                                aria-label="name">
                            <span class="input-group-text">é‚®ç®±</span>
                            <input type="text" class="form-control" id="email_" placeholder="githubè´¦æˆ·çš„email"
                                aria-label="email">
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">Access_Token</span>
                            <input type="password" class="form-control" id="accessTokenInput" placeholder="token"
                                aria-label="atoken">
                            <button type="button" class="btn btn-outline-primary" id="show_hide">æ˜¾ç¤º</button>
                        </div class="mb-3">
                        <div class="mb-3" style="width: 100%;text-align: center;" id="sulv"></div>
                        <div class="input-group mb-4">
                            <span class="input-group-text">githubå›¾åºŠCDNåŠ é€Ÿ</span>
                            <input type="text" class="form-control" placeholder="https://raw.githubusercontent.com"
                                aria-label="imgpath" id="img_cdn">
                            <span class="input-group-text">/</span>
                        </div>

                        <span class="mb-2">githubå›¾åºŠè®¾ç½®</span>
                        <div class="input-group mb-4">
                            <span class="input-group-text" id="img_set_box_text"></span>
                            <input type="text" class="form-control" placeholder="å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„" aria-label="imgpath"
                                id="img_set_box_">
                            <span class="input-group-text">/</span>
                        </div>

                        <button class="btn btn-primary w-25" type="submit" id="save_info">ä¿å­˜</button>
                    </div>

                </div>
            </div>
        </div>
    </div>



    <span style="font-size: 0.5rem;width: 100%;text-align: center;position: fixed;right: 25px;bottom: 5px;">
        Copyright Â© by <a href="https://binfen23.github.io" style="text-decoration: none;" target="_blank">Zeb</a> |
        Powered by <a href="https://github.com/binfen23/bfmanage" style="text-decoration: none;"
            target="_blank">bfmanage</a>
    </span>
</body>




<script>

    var owner = "";
    var repo = "";
    var img_path = "";
    var atoken = "";
    var name_ = "";
    var email_ = "";
    var imgcdn = "";


    function ready(callbackFunction) {
        if (document.readyState !== 'loading') {
            callbackFunction();
        } else {
            document.addEventListener('DOMContentLoaded', callbackFunction);
        }
    }
    var cfg_data = "è¿˜æœªæ­£ç¡®è®¾ç½®é…ç½®";
    //è¯»å–é…ç½®
    function get_config() {
        if (localStorage.getItem('config') == null) {
            let configs = {
                "zt": "light",
                "zdbc": false,
                "tcan": false,
                "sz": {
                    "yyz": "",
                    "cangku": "",
                    "token": "",
                    "img_cdn": "",
                    "lujing": "",
                    "tjz": "",
                    "email": ""
                }
            }
            localStorage.setItem('config', JSON.stringify(configs));
            cfg_data = configs
        } else {
            let config = JSON.parse(localStorage.getItem('config'));
            cfg_data = config
        }

        return cfg_data
    }

    //è®¾ç½®é…ç½®
    function set_config(cfgs) {
        localStorage.setItem('config', JSON.stringify(cfgs));
    }

    //æ›´æ–°é…ç½®çŠ¶æ€
    function change_ui(cfgs) {
        document.getElementById("tuchuang").checked = cfgs.tcan;
        document.getElementById("auto_save").checked = cfgs.zdbc;
        document.getElementById("owner_").value = cfgs.sz.yyz;
        document.getElementById("repo_").value = cfgs.sz.cangku;
        document.getElementById("name_").value = cfgs.sz.tjz;
        document.getElementById("email_").value = cfgs.sz.email;
        document.getElementById("accessTokenInput").value = cfgs.sz.token;
        document.getElementById("img_cdn").value = cfgs.sz.img_cdn;
        document.getElementById("img_set_box_").value = cfgs.sz.lujing;
    }
    function change_post() {
        if (localStorage.getItem('post_data') == null) {
            let post_data = {
                "pt": "",
                "pd": "",
                "pc": "",
                "ptag": "",
                "pi": "",
                "pia": "",
                "pz": "",
                "ps": "",
                "ptb": ""
            }
            localStorage.setItem('post_data', JSON.stringify(post_data));
        } else {
            let post_data = JSON.parse(localStorage.getItem('post_data'));
            document.getElementById("post_title").value = post_data.pt;
            document.getElementById("post_description").value = post_data.pd;
            document.getElementById("post_categories").value = post_data.pc;
            document.getElementById("post_tag").value = post_data.ptag;
            document.getElementById("post_img").value = post_data.pi;
            document.getElementById("post_img_alt").value = post_data.pia;
            document.getElementById("zhiding").checked = post_data.pz;
            document.getElementById("shuxue").checked = post_data.ps;
            document.getElementById("tubiao").checked = post_data.ptb;
        }

        if (localStorage.getItem('contents') == null) {
            localStorage.setItem('contents', "");
        } else {
            if (localStorage.getItem('contents') !== "") {
                let contents = JSON.parse(localStorage.getItem('contents'));
                editor.setMarkdown(contents);
            }
        }



    }


    //å®æ—¶æ›´æ–°ä¸Šä¼ å›¾ç‰‡æ¡†æ ·å¼
    function changestyle() {
        var fb = document.getElementById('file-box2');
        fb.ondragover = function (ev) {
            //é˜»æ­¢æµè§ˆå™¨é»˜è®¤æ‰“å¼€æ–‡ä»¶çš„æ“ä½œ
            ev.preventDefault();
            this.style.borderColor = '#0097dfcc';
            this.style.background = '#67ccff1f';
        };
        fb.ondragleave = function () {
            //æ¢å¤è¾¹æ¡†é¢œè‰²
            this.style.borderColor = '#efefef';
            this.style.background = 'none';
        };
        fb.ondrop = function (ev) {
            //æ¢å¤è¾¹æ¡†é¢œè‰²
            this.style.borderColor = '#efefef';
            this.style.background = 'none';
        };
    }

    // ä¸Šä¼ å›¾ç‰‡
    function upimg(fileName, base64, fileExt, el) {
        return new Promise((resolve, reject) => {
            let date1 = getCurrentDate(1);
            let date2 = getCurrentDate(2);
            let date3 = getCurrentDate(3);
            let fn = date3 + fileName;
            let base64Data = base64.replace(/^data:image\/\w+;base64,/, "");
            el.classList.add("breathing");

            fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${img_path}/${date2}/${fn}`, {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + atoken,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    "content": base64Data,
                    "message": date1 + fileName
                }),
            })
                .then(response => {
                    switch (response.status) {
                        case 200:
                        case 201:
                            console.log("æ–°æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼ŒçŠ¶æ€ç ï¼š", response.status);
                            el.parentNode.parentNode.removeChild(el.parentNode);
                            var imgsrc = `${imgcdn}/${owner}/${repo}/main/${img_path}/${date2}/${fn}`;
                            add_recent_img(imgsrc, fn);

                            break;
                        case 404: // Resource not found
                            console.error("èµ„æºæœªæ‰¾åˆ°ï¼ŒçŠ¶æ€ç ï¼š", response.status);
                            // å¯èƒ½éœ€è¦å¤„ç†æ‰¾ä¸åˆ°èµ„æºçš„æƒ…å†µ
                            break;
                        case 409: // Conflict - æ–‡ä»¶å†²çªï¼Œå¯èƒ½åŒæ—¶æœ‰å…¶ä»–æ›´æ–°æ“ä½œ
                            console.warn("æ–‡ä»¶å†²çªï¼ŒçŠ¶æ€ç ï¼š", response.status);
                            // å¤„ç†å†²çªé€»è¾‘
                            break;
                        case 422: // Validation failed æˆ– è¢«è®¤å®šä¸ºåƒåœ¾è¯·æ±‚
                            console.error("éªŒè¯å¤±è´¥æˆ–è¯·æ±‚è¢«é™åˆ¶ï¼ŒçŠ¶æ€ç ï¼š", response.status);
                            // éœ€è¦æ£€æŸ¥æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚æˆ–ç¨åå†è¯•
                            break;
                        default:
                            if (!response.ok) {
                                throw new Error(`æœªçŸ¥é”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š${response.status}`);
                            }
                    }
                    el.classList.remove("breathing"); // ä¸è®ºç»“æœå¦‚ä½•ï¼Œç§»é™¤åŠ è½½åŠ¨ç”»
                    resolve();
                })
                .catch(error => {
                    console.error('è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼š', error);
                    el.classList.remove("breathing"); // ç¡®ä¿é”™è¯¯æ—¶ç§»é™¤åŠ¨ç”»æ•ˆæœ
                    reject(error);
                });
        });
    }

    // å®æ—¶æ›´æ–°æ‹¥æœ‰è€…å’Œä»“åº“å
    function get_name_repo() {
        let owner = document.getElementById("owner_");
        let repo = document.getElementById("repo_");
        let IBtext = document.getElementById("img_set_box_text");
        IBtext.innerText = "https://github.com/" + owner.value + "/" + repo.value + "/"
    }

    // è·å–æ—¶é—´æ—¥æœŸ 1ï¼šæ—¶é—´æ—¥æœŸ  2ï¼šæ—¥æœŸ   3ï¼šæ—¶é—´
    function getCurrentDate(datetype) {
        var now = new Date();
        var year = now.getFullYear(); //å¾—åˆ°å¹´ä»½
        var month = now.getMonth(); //å¾—åˆ°æœˆä»½
        var date = now.getDate(); //å¾—åˆ°æ—¥æœŸ
        var day = now.getDay(); //å¾—åˆ°å‘¨å‡ 
        var hour = now.getHours(); //å¾—åˆ°å°æ—¶
        var minu = now.getMinutes(); //å¾—åˆ°åˆ†é’Ÿ
        var sec = now.getSeconds(); //å¾—åˆ°ç§’
        month = month + 1;
        if (month < 10) month = "0" + month;
        if (date < 10) date = "0" + date;
        if (hour < 10) hour = "0" + hour;
        if (minu < 10) minu = "0" + minu;
        if (sec < 10) sec = "0" + sec;
        var time = "";
        if (datetype == 1) {
            time = year + "-" + month + "-" + date + " " + hour + ":" + minu + ":" + sec + "-";
            return time;
        } else if (datetype == 2) {
            time = year + "-" + month + "-" + date;
            return time;
        } else if (datetype == 3) {
            time = hour + ":" + minu + ":" + sec + "-";
            return time;
        } else if (datetype == 4) {
            time = year + "-" + month + "-" + date + " " + hour + ":" + minu + ":" + sec;
            return time;
        }

    }

    // å°†æ–‡ä»¶è½¬æ¢ä¸ºBase64ç¼–ç 
    function toBase64() {
        var input = document.querySelector('input[type=file]');
        var files = input.files;
        if (files) {
            for (let i = 0; i < files.length; i++) {
                (function (index) { // ä½¿ç”¨IIFEæ¥åˆ›å»ºç‹¬ç«‹çš„ä½œç”¨åŸŸ
                    var file = files[index];
                    // è®¡ç®—æ–‡ä»¶å¤§å°
                    var fileSize = 0;
                    var fileSizeMB = file.size / 1024 / 1024;
                    if (fileSizeMB < 1) {
                        fileSize = (file.size / 1024).toFixed(2) + " KB";
                    } else {
                        fileSize = fileSizeMB.toFixed(2) + " MB";
                    }

                    // è¯»å–æ–‡ä»¶ä¸ºbase64
                    var reader = new FileReader();
                    reader.onloadend = function (e) {
                        var imgBase64 = e.target.result;
                        var base64Data = imgBase64.replace(/^data:image\/\w+;base64,/, "");
                        // è·å–æ–‡ä»¶åå’Œåç¼€
                        var fileName = file.name;
                        var fileExt = fileName.split('.').pop();
                        // è¾“å‡ºä¿¡æ¯
                        // console.log("æ–‡ä»¶å: " + fileName);
                        // console.log("æ–‡ä»¶åç¼€: " + fileExt);
                        // console.log("æ ¼å¼åçš„base64ç¼–ç : " + base64Data);
                        // console.log("æ–‡ä»¶å¤§å°: " + fileSize);
                        addimgbox(imgBase64, fileName, fileExt, fileSize);
                        check_preview();
                    };

                    // è¯»å–æ–‡ä»¶
                    reader.readAsDataURL(file);
                })(i); // ç«‹å³æ‰§è¡ŒIIFEå¹¶ä¼ å…¥å½“å‰å¾ªç¯çš„ç´¢å¼•
            }
        }
    }




    // æ·»åŠ å›¾ç‰‡div
    function addimgbox(base64, fileName, fileExt, fileSize) {
        const ibox = document.createElement('div')
        ibox.innerHTML = [
            '<span style="cursor: pointer;width: 20px;height: 20px;color: #fff;background: #ff0000a6;padding: 0.3rem;line-height: 20px;display: flex;justify-content: center;align-items: center;font-size: 0.5rem;position: absolute;right: 0;top: 0; border-top-left-radius: 50%;border-bottom-left-radius: 50%;" class="f_btn" onclick="del_preview(this.parentNode)">X</span>',
            `<img src="${base64}" alt="" data-filename="${fileName}" data-fileext="${fileExt}" data-filesize="${fileSize}" onclick="toggleZoom(this)" style="object-fit: contain;object-position: center; width: 50px;height: 50px;background: #00000024;">`

        ].join('')
        ibox.classList.add("me-2");
        ibox.style.width = '50px';
        ibox.style.height = '50px';
        ibox.style.position = 'relative';

        document.getElementById("img_list_box").prepend(ibox);
    }

    //æ·»åŠ æœ€è¿‘ä¸Šä¼ çš„å›¾ç‰‡
    function add_recent_img(src, fileName) {
        const ibox = `
        <div class="me-2 position-relative " style="width:50px;height:50px;">
            <div>
            <span style="cursor: pointer;width: 20px;height: 20px;color: #fff;background: #0089ffa6;padding: 0.3rem;line-height: 20px;display: flex;justify-content: center;align-items: center;font-size: 0.5rem;position: absolute;left: 0;top: 0; border-top-right-radius: 50%;border-bottom-right-radius: 50%;" class="f_btn" onclick="charu(this)">+</span>
            <span style="cursor: pointer;width: 20px;height: 20px;color: #fff;background: #ff0000a6;padding: 0.3rem;line-height: 20px;display: flex;justify-content: center;align-items: center;font-size: 0.5rem;position: absolute;right: 0;top: 0; border-top-left-radius: 50%;border-bottom-left-radius: 50%;" class="f_btn" onclick="del_recent_img(this.parentNode.parentNode)">X</span>
            </div>
            <img src="${src}" alt="" data-filename="${fileName}" onclick="toggleZoom(this)" style="object-fit: contain;object-position: center; width: 50px;height: 50px;background: #00000024;">
        </div>
        `;

        document.getElementById('recent_img_list_box').insertAdjacentHTML('afterbegin', ibox);

        if (localStorage.getItem('recent_img') === null) {
            localStorage.setItem('recent_img', JSON.stringify([[fileName, src]]));
        } else {
            const existingData = JSON.parse(localStorage.getItem('recent_img'));
            // ä½¿ç”¨äº†æ‰©å±•è¿ç®—ç¬¦(...)æ¥åˆ›å»ºç°æœ‰æ•°æ®çš„å‰¯æœ¬ï¼Œå¹¶æ·»åŠ äº†æ–°å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥é¿å…ç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„ã€‚
            const newData = [...existingData, [fileName, src]];
            localStorage.setItem('recent_img', JSON.stringify(newData));
        }
    }

    //æœ¬åœ°å­˜å‚¨åŠ è½½æœ€è¿‘ä¸Šä¼ å›¾ç‰‡
    function load_recent_img() {
        if (localStorage.getItem('recent_img') !== null) {
            const existingData = JSON.parse(localStorage.getItem('recent_img'));
            localStorage.removeItem('recent_img');
            for (let i = 0; i < existingData.length; i++) {
                add_recent_img(existingData[i][1], existingData[i][0])
            }
        }
    }

    function del_recent_img(el) {
        del_preview(el);
        let recentimglist = document.getElementById("recent_img_list_box").querySelectorAll("img");
        localStorage.removeItem('recent_img');
        var datalist = [];
        for (let i = 0; i < recentimglist.length; i++) {
            let fn = recentimglist[i].getAttribute('data-filename');
            let data = [fn, recentimglist[i].src];
            datalist.unshift(data);
        }
        localStorage.setItem('recent_img', JSON.stringify(datalist));

    }


    // æ”¾å¤§ç¼©å°å›¾ç‰‡
    function toggleZoom(element) {
        if (element.classList.contains("zoomed")) {
            // å¦‚æœå…ƒç´ å·²æœ‰ zoomed ç±»ï¼Œåˆ™ç§»é™¤å®ƒï¼Œå®ç°ç¼©å°æ•ˆæœ
            element.classList.remove("zoomed");
        } else {
            // å¦åˆ™ï¼Œæ·»åŠ  zoomed ç±»ï¼Œå®ç°æ”¾å¤§æ•ˆæœ
            element.classList.add("zoomed");
        }
    }

    //å¼€å…³å›¾åºŠæ 
    function checktuchuangstatus(tc_btn, tuchuang_switch_box) {
        let cfg = get_config();
        if (tc_btn.checked) {
            // console.log("å›¾åºŠå·²å¼€å¯");
            tuchuang_switch_box.style.display = 'flex';
            cfg.tcan = true;
            // åˆå§‹åŒ–å›¾åºŠ
            initPage();

        } else {
            // console.log("å›¾åºŠå·²å…³é—­");
            tuchuang_switch_box.style.display = 'none';
            cfg.tcan = false;
        }
        set_config(cfg);
    }

    // åˆ é™¤é¢„è§ˆå›¾ç‰‡
    function del_preview(element) {
        element.parentNode.removeChild(element);
        check_preview();
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰é¢„è§ˆå›¾ç‰‡å†³å®šæ˜¯å¦æ˜¾ç¤ºä¸Šä¼ æŒ‰é’®
    function check_preview() {
        if (document.getElementById("img_list_box").innerHTML == "") {
            document.getElementById("preview_box").style.display = 'none';
        } else {
            document.getElementById("preview_box").style.display = 'flex';
        }
    }

    // é€šè¿‡apiè·å–treeä¿¡æ¯
    async function get_info(url) {
        try {
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36",
                    'Authorization': 'Bearer ' + atoken,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            // const dataheader = await response.headers;
            // console.log(dataheader.get("x-ratelimit-limit"));
            // console.log(dataheader.get("x-ratelimit-remaining"));
            // console.log(dataheader.get("x-ratelimit-used"));
            // console.log(dataheader.get("x-ratelimit-reset"));
            return data;
        } catch (error) {
            console.error('Error fetching repo list:', error);
            return "è¯·æ±‚å¤±è´¥";
        }
    }

    // é€šè¿‡åˆ†å‰²æ–œæ†è¿›è¡Œå¾ªç¯ è®¾ç½®ä¸­å›¾åºŠè·¯å¾„ï¼ˆå‰åä¸èƒ½æœ‰æ–œæ†ï¼‰ä¾‹ï¼šassets/img/blog_imgs è¿™æ ·å¾ªç¯3æ¬¡ï¼Œ
    async function traverseToPath(img_path, initialUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/main`) {
        const parts = img_path.split('/').filter(Boolean); // è¿‡æ»¤æ‰å¯èƒ½çš„ç©ºå­—ç¬¦ä¸²
        let tree_url = initialUrl;

        for (const part of parts) {
            try {
                const data = await get_info(tree_url);
                const item = data.tree.find(item => item.path === part && item.type === 'tree');
                if (item) {
                    // console.log(`Found path part: ${part}, new tree_url: ${item.url}`);
                    tree_url = item.url;
                } else {
                    console.error(`æœªæ‰¾åˆ°åˆ†å‰²è·¯å¾„: ${part}`);
                    break; // å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”éƒ¨åˆ†ï¼Œåˆ™ç»ˆæ­¢å¾ªç¯
                }
            } catch (err) {
                console.error(`åœ¨æ­¤æŠ¥é”™ ${part}:`, err);
                break; // åœ¨å‘ç”Ÿé”™è¯¯æ—¶ä¹Ÿç»ˆæ­¢å¾ªç¯
            }
        }
        return tree_url;
    }


    // æ·»åŠ å›¾åºŠé¢„è§ˆæ¡†å†…å›¾ç‰‡çš„div
    function add_imgsbox(path_, type_, url_) {
        if (type_ == "tree") {
            var imgboxhtml = `
            <div class="accordion-item mt-2 mb-2 border">
                <div class="accordion-header" id="header_${path_}">
                    <button class="accordion-button p-2 collapsed imgstitle" type="button" data-bs-toggle="collapse" data-bs-target="#contentbox_${path_}" aria-expanded="false" aria-controls="contentbox_${path_}" onclick="toggleAccordion(this) " data-shaurl="${url_}">${path_}</button>
                </div>
                <div id="contentbox_${path_}" class="accordion-collapse collapse" aria-labelledby="header_${path_}" data-bs-parent="#tc_content_box">
                    <div class="accordion-body scrollbar-box me-1" id="content_${path_}" style="display: grid;grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));gap: 10px;overflow-y: auto;height: 500px;"></div>
                </div>
            </div>
            `;
            document.getElementById('tc_content_box').insertAdjacentHTML('afterbegin', imgboxhtml);

        }

    }

    //å›¾åºŠæ æ·»åŠ å›¾ç‰‡
    function add_imgs(date_, path_, nodeid) {
        var imgsbox = `
        <div class="position-relative">
            <div class="position-absolute AB" style="top: 50%;width: 100%;text-align: center;background: #0000005c;padding: 5px;">
                <span class="me-3" onclick="charu(this)" style="cursor: pointer;">ğŸ“„</span>
                <span onclick="fuzhi(this)" style="cursor: pointer;">ğŸ”—</span>
            </div>
            <img src="${imgcdn}/${owner}/${repo}/main/${img_path}/${date_}/${path_}" alt="" class="w-100 h-100 rounded p-1" style="object-fit: contain;object-position: center;cursor: pointer;background: #00000024;" onclick="toggleZoom(this)"/>
        </div>
        `;
        document.getElementById(nodeid).insertAdjacentHTML('afterbegin', imgsbox);

    }

    // åˆ·æ–°å›¾åºŠé¢„è§ˆæ 
    async function re_imglists_box() {
        try {
            const data = await traverseToPath(img_path);
            const lists = await get_info(data);
            localStorage.setItem('imglists', JSON.stringify(lists));
            console.log("æ•°æ®å­˜å‚¨åˆ°localStorageæˆåŠŸ");
        } catch (err) {
            console.error("åœ¨re_imglists_boxä¸­æ•è·åˆ°é”™è¯¯:", err);
        }
    }

    async function postslist(initialUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/main`) {
        let tree_url = initialUrl;
        let part = "_posts"
        try {
            const data = await get_info(tree_url);
            const item = data.tree.find(item => item.path === part && item.type === 'tree');
            if (item) {
                // console.log(`Found path part: ${part}, new tree_url: ${item.url}`);
                tree_url = item.url;
            } else {
                console.error(`æœªæ‰¾åˆ°è·¯å¾„: ${part}`);
            }
        } catch (err) {
            console.error(`åœ¨æ­¤æŠ¥é”™ ${part}:`, err);
        }

        return tree_url;
    }
    // åˆ·æ–°æ–‡ç« å†…å®¹
    async function re_postlists_box() {
        document.getElementById("load_post").disabled = true;
        document.getElementById("home_content").innerHTML = '';
        add_loading(document.getElementById("home_content"));
        try {
            const data = await postslist();
            // console.log(data);
            const lists = await get_info(data);
            localStorage.setItem("postlist", JSON.stringify(lists.tree));
            let postlist_date = getCurrentDate(1);
            localStorage.setItem("postlist_date", postlist_date);

        } catch (err) {
            console.error("åœ¨re_imglists_boxä¸­æ•è·åˆ°é”™è¯¯:", err);
        }
        del_loading(document.getElementById("home_content"));
        document.getElementById("load_post").disabled = false;
        change_post_list();
    }

    //ä¸»é¡µæ·»åŠ æ–‡ç« 
    function add_posts_item(title, sha, url, date_, path) {
        var post_item = `
        <div class="post_item p-4 m-2 border rounded d-flex" data-sha="${sha}" data-url="${url}" data-path="${path}" data-title="${title}">
            <div class="flex-fill">
                <a href="https://binfen23.github.io/posts/${title}/" target="_blank" style="text-decoration: none;color: var(--bs-body-color);">${title}</a>
                <div style="font-size: 0.5rem;margin-top: 5px;color: #979797;">ğŸ“… ${date_}</div>
            </div>
            <div class="d-flex align-items-center justify-content-center">
                <span class="edit_btn border rounded p-1 m-1" style="cursor: pointer;font-size: 0.8rem;" onclick="edit_post(this)">âœï¸</span>
                <span class="edit_btn border rounded p-1 m-1" style="cursor: pointer;font-size: 0.8rem;" onclick="delete_post(this)">ğŸ—‘ï¸</span>
            </div>
        </div>
        `;
        document.getElementById("home_content").insertAdjacentHTML('beforeend', post_item);

    }

    function change_post_list() {
        if (localStorage.getItem('postlist') !== null && localStorage.getItem('postlist') !== "") {
            let postlist = JSON.parse(localStorage.getItem('postlist'));
            let postlist_date = localStorage.getItem('postlist_date');
            document.getElementById("postlist_changedate").innerText = postlist_date + 'åŠ è½½æ–‡ç« å†…å®¹';
            for (let i = 0; i < postlist.length; i++) {
                let path = postlist[i].path;
                let dateStr = path.split("-").slice(0, 3).join("-");
                // console.log(dateStr);
                let parts = path.split('-');
                let title = " ";
                if (path == ".placeholder") {
                    continue
                }
                if (parts[3] !== ".md" && path !== ".placeholder") {
                    title = parts[3].replace(/\.md$/, '');
                }
                // console.log(title)
                let sha = postlist[i].sha;
                let url = postlist[i].url;
                add_posts_item(title, sha, url, dateStr, postlist[i].path);
            }

        }
    }


    // å›¾åºŠæ ‡é¢˜æŒ‰é’®åˆ¤æ–­å±•å¼€è¿˜æ˜¯é—­åˆ
    function toggleAccordion(el) {
        var isCollapsed = el.classList.contains('collapsed');
        if (isCollapsed) {
            // console.log("é—­åˆ:" + el.innerText);
            del_loading(el.parentNode.nextElementSibling)//ç§»é™¤åŠ è½½åŠ¨ç”»
        } else {
            // console.log("å±•å¼€:" + el.innerText);

            add_loading(el.parentNode.nextElementSibling);//æ­£åœ¨åŠ è½½åŠ¨ç”»

            if (localStorage.getItem(el.innerText) === null) {
                // åŠ è½½url
                get_info(el.getAttribute('data-shaurl'))
                    .then(lists => {
                        localStorage.setItem(el.innerText, JSON.stringify(lists));
                        del_loading(el.parentNode.nextElementSibling)//ç§»é™¤æ­£åœ¨åŠ è½½åŠ¨ç”»
                        document.getElementById(`content_${el.innerText}`).innerHTML = "";
                        var item_img_lists = JSON.parse(localStorage.getItem(el.innerText));
                        var item_img_tree = item_img_lists.tree;
                        for (let i = 0; i < item_img_tree.length; i++) {
                            add_imgs(el.innerText, item_img_tree[i].path, `content_${el.innerText}`)
                        }
                    })
                    .catch(err2 => {
                        console.error("æ— æ³•è·å–æœ€åä¸€ä¸ªtreeè¿”å›çš„æ•°æ®", err2);
                    })

            } else {
                del_loading(el.parentNode.nextElementSibling); //ç§»é™¤åŠ è½½åŠ¨ç”»
                document.getElementById(`content_${el.innerText}`).innerHTML = "";
                var item_img_lists = JSON.parse(localStorage.getItem(el.innerText));
                var item_img_tree = item_img_lists.tree;
                for (let i = 0; i < item_img_tree.length; i++) {
                    add_imgs(el.innerText, item_img_tree[i].path, `content_${el.innerText}`)
                }
            }

        }
    }


    // æ·»åŠ åŠ è½½loading
    function add_loading(el) {
        el.insertAdjacentHTML('afterbegin', '<div class="loader"></div>');
    }

    // ç§»é™¤åŠ è½½loading
    function del_loading(el) {
        var loaders = el.querySelectorAll('.loader');
        for (var i = 0; i < loaders.length; i++) {
            el.removeChild(loaders[i]);
        }
    }


    function add_imglists() {
        var img_lists = JSON.parse(localStorage.getItem('imglists'));
        if (img_lists == "è¯·æ±‚å¤±è´¥") {
            var imgsbox = `
                <div class="w-100 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                    âš ï¸è¯·æ±‚å¤±è´¥ (â•¯Â°Ğ”Â°)â•¯ï¸µ â”»â”â”»
                    <p style="font-size: 0.5rem;color: #979797;margin: 0.5rem;">æ£€æŸ¥æ‹¥æœ‰è€…ã€ä»“åº“åã€å›¾ç‰‡è·¯å¾„ã€Token</p>
                </div>
            `;
            document.getElementById("tc_content_box").insertAdjacentHTML('afterbegin', imgsbox);
        } else {
            var img_tree = img_lists.tree;
            for (let i = 0; i < img_tree.length; i++) {
                add_imgsbox(img_tree[i].path, img_tree[i].type, img_tree[i].url);
            }
        }

    }

    async function initPage() {
        try {
            if (localStorage.getItem('imglists') === null) {
                await re_imglists_box();
                del_loading(document.getElementById("tc_content_box"));
                add_imglists();
                document.getElementById('update_img').disabled = false;
            } else {
                del_loading(document.getElementById("tc_content_box"));
                add_imglists();
                document.getElementById('update_img').disabled = false;
            }
        } catch (err) {
            console.error("åˆå§‹åŒ–é¡µé¢æ—¶å‘ç”Ÿé”™è¯¯:", err);
            document.getElementById('update_img').disabled = false;
        }
    }

    // æŸ¥æ‰¾å¹¶å¤åˆ¶å›¾ç‰‡é“¾æ¥çš„å‡½æ•°
    function fuzhi(element) {
        // è·å–å½“å‰ç‚¹å‡»å…ƒç´ çš„çˆ¶å…ƒç´ 
        var parentElement = element.parentElement;
        // ä»çˆ¶å…ƒç´ çš„å…„å¼Ÿå…ƒç´ ä¸­æ‰¾åˆ°imgæ ‡ç­¾
        var imgElement = parentElement.previousElementSibling || parentElement.nextElementSibling;

        // ç¡®ä¿æ‰¾åˆ°äº†imgå…ƒç´ 
        if (imgElement && imgElement.tagName.toLowerCase() === 'img') {
            // è·å–imgçš„srcå±æ€§
            var imgSrc = imgElement.src;
            // æ‰§è¡Œå¤åˆ¶æ“ä½œ
            copyTextToClipboard(imgSrc);
            // alert('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        } else {
            console.error('æœªæ‰¾åˆ°ç›¸é‚»çš„imgå…ƒç´ ');
        }
    }

    // ç”¨äºæ’å…¥æˆ–å¤„ç†å›¾ç‰‡é“¾æ¥çš„åŠŸèƒ½å‡½æ•°ï¼Œè¿™é‡Œä»…ä¸ºç¤ºä¾‹ï¼Œå…·ä½“å®ç°å–å†³äºéœ€æ±‚
    function charu(element) {
        var pp_Element_img_list = element.parentElement.parentElement.querySelectorAll("img");
        // console.log(pp_Element_img_list);
        var imgSrc = pp_Element_img_list[0].src;
        // document.getElementsByClassName("ProseMirror")[0].append(`![image](${imgSrc})`)
        editor.insertText(`![image](${imgSrc})`);

    }

    // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿çš„è¾…åŠ©å‡½æ•°
    function copyTextToClipboard(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function () {
                // å·²å¤åˆ¶æˆåŠŸçš„å¤„ç†
            }, function (err) {
                console.error('æ— æ³•å¤åˆ¶åˆ°å‰ªè´´æ¿:', err);
            });
        } else {
            // Fallback for older browsers
            var textArea = document.createElement("textarea");
            textArea.value = text;
            // Make it invisible
            textArea.style.position = 'absolute';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('å¤åˆ¶æˆåŠŸ');
            } catch (ex) {
                console.error('æ— æ³•å¤åˆ¶æ–‡æœ¬:', ex);
            }
            document.body.removeChild(textArea);
        }
    }

    function updateimgdata() {
        document.getElementById('update_img').disabled = true;
        var imgstitlelsit = document.getElementsByClassName("imgstitle");
        for (let i = 0; i < imgstitlelsit.length; i++) {
            localStorage.removeItem(imgstitlelsit[i].innerText);
        }
        localStorage.removeItem("imglists");
        document.getElementById("tc_content_box").innerHTML = "";
        add_loading(document.getElementById("tc_content_box"));
        initPage();



    }


    async function get_img_list() {
        document.getElementById('uploadimg').disabled = true;
        let upimglist = document.getElementById("img_list_box").querySelectorAll("img");
        for (let i = 0; i < upimglist.length; i++) {
            // console.log(`Processing image at index ${i}`);
            let iname = upimglist[i].getAttribute('data-filename');
            let imgBase64 = upimglist[i].src;
            let Ext = upimglist[i].getAttribute('data-fileext');
            // console.log(`Index: ${i}, Name: ${name}, Ext: ${Ext}`);
            // console.log("èŠ‚ç‚¹ï¼š")
            // console.log(upimglist[i])
            try {
                await upimg(iname, imgBase64, Ext, upimglist[i]);
                document.getElementById('uploadimg').disabled = false;
                check_preview();
            } catch (error) {
                console.error(`Error uploading image ${name}: `, error);
                document.getElementById('uploadimg').disabled = false;
                // å¤„ç†é”™è¯¯ï¼Œå¯ä»¥é€‰æ‹©ç»§ç»­å¾ªç¯æˆ–ä¸­æ–­
            }

        }
    }

    //æ–‡å­—è½¬base64
    function btoaUnicode(str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {
            return String.fromCharCode(parseInt(p1, 16));
        }));
    }
    //å‘å¸ƒæ–‡ç« 
    function post_() {
        return new Promise((resolve, reject) => {
            document.getElementById('_post').disabled = true;
            var title_ = document.getElementById("post_title").value;
            var description_ = document.getElementById("post_description").value;
            var categories_ = document.getElementById("post_categories").value.replace(/ï¼Œ/g, ',');
            var tags_ = document.getElementById("post_tag").value.replace(/ï¼Œ/g, ',');
            var pin_ = document.getElementById("zhiding").checked;
            var math_ = document.getElementById("shuxue").checked;
            var mermaid_ = document.getElementById("tubiao").checked;
            var _date = getCurrentDate(4);
            var _date2 = getCurrentDate(2);
            var _file_name = `${_date2}-${title_}.md`;
            var post_img_src = document.getElementById("post_img").value;
            var post_img_alt = document.getElementById("post_img_alt").value;
            var img_s = "";
            if (post_img_src !== "") {
                img_s = "\nimage:\n    path: " + post_img_src + "\n    lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA\n    alt: " + post_img_alt;
            }
            var post_c = editor.getMarkdown();
            var md_title_c = [
                "---\ntitle: ", title_,
                "\ndescription: ", description_,
                "\ndate: ", _date + " +0800",
                "\ncategories: [", categories_, "]\ntags: [", tags_,
                "]\npin: ", pin_,
                "\nmath: ", math_,
                "\nmermaid: ", mermaid_,
                img_s,
                "\n---\n"
            ].join('');

            var b_content = md_title_c + post_c;
            var base64_content = btoaUnicode(b_content);

            console.log(md_title_c);
            console.log(base64_content);
            console.log(_file_name);

            fetch(`https://api.github.com/repos/${owner}/${repo}/contents/_posts/${_file_name}`, {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + atoken,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    "content": base64_content,
                    "message": `å‘å¸ƒæ–‡ç« ã€Š${_file_name}ã€‹`
                }),
            })
                .then(response => {
                    switch (response.status) {
                        case 200:
                        case 201:
                            let t = ["post_title", "post_description", "post_categories", "post_tag", "post_img", "post_img_alt"];
                            for (let i = 0; i < t.length; i++) {
                                document.getElementById(t[i]).value = "";
                            }
                            document.getElementById("zhiding").checked = false;
                            document.getElementById("shuxue").checked = false;
                            document.getElementById("tubiao").checked = false;
                            editor.reset();
                            alert("(Ùˆâ€¢Ì€ã…‚â€¢Ì)Ùˆâœ§ å‘è¡¨æˆåŠŸ ğŸ‰ğŸ‰", "success");
                            console.log("(Ùˆâ€¢Ì€ã…‚â€¢Ì)Ùˆâœ§ å‘è¡¨æˆåŠŸ ğŸ‰ğŸ‰", response.status);
                            break;
                        case 404: // Resource not found
                            alert("(;Â´à¼àº¶Ğ”à¼àº¶`) è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ‹¥æœ‰è€…å’Œä»“åº“å", "danger");
                            console.error("(;Â´à¼àº¶Ğ”à¼àº¶`) è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ‹¥æœ‰è€…å’Œä»“åº“å çŠ¶æ€ç ï¼š", response.status);
                            // å¯èƒ½éœ€è¦å¤„ç†æ‰¾ä¸åˆ°èµ„æºçš„æƒ…å†µ
                            break;
                        case 409: // Conflict - æ–‡ä»¶å†²çªï¼Œå¯èƒ½åŒæ—¶æœ‰å…¶ä»–æ›´æ–°æ“ä½œ
                            alert("Î£(â˜‰Ğ´âŠ™) å½“å‰æ–‡ä»¶åä¸githubç«¯çš„æ–‡ä»¶åå†²çª", "danger");
                            console.warn("Î£(â˜‰Ğ´âŠ™) å½“å‰æ–‡ä»¶åä¸githubç«¯çš„æ–‡ä»¶åå†²çª çŠ¶æ€ç ï¼š", response.status);
                            // å¤„ç†å†²çªé€»è¾‘
                            break;

                        case 401:
                        case 422: // Validation failed æˆ– è¢«è®¤å®šä¸ºåƒåœ¾è¯·æ±‚
                            alert("(|||ï¾ŸĞ´ï¾Ÿ) Tokenå·²ç»è¶…è¿‡githubæ¬¡æ•°é™åˆ¶ï¼Œéœ€ç­‰å¾…æ¢å¤æ¬¡æ•°", "danger");
                            console.error("(|||ï¾ŸĞ´ï¾Ÿ) Tokenå·²ç»è¶…è¿‡githubæ¬¡æ•°é™åˆ¶ï¼Œéœ€ç­‰å¾…æ¢å¤æ¬¡æ•° çŠ¶æ€ç ï¼š", response.status);
                            // éœ€è¦æ£€æŸ¥æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚æˆ–ç¨åå†è¯•
                            break;
                        default:
                            if (!response.ok) {
                                alert(`(â” â—Ÿ;ï¾ŸĞ´ï¾Ÿ)ãƒ æœªçŸ¥é”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š${response.status}`, "danger");
                                throw new Error(`(â” â—Ÿ;ï¾ŸĞ´ï¾Ÿ)ãƒ æœªçŸ¥é”™è¯¯ï¼ŒçŠ¶æ€ç  ${response.status}`);
                            }
                    }
                    document.getElementById('_post').disabled = false;
                    resolve();
                })
                .catch(error => {
                    alert("ï½¡ï¾Ÿãƒ½(ï¾ŸÂ´Ğ”`)ï¾‰ï¾Ÿï½¡ è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥Token", "danger");
                    console.error('ï½¡ï¾Ÿãƒ½(ï¾ŸÂ´Ğ”`)ï¾‰ï¾Ÿï½¡ è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥Token ', error);
                    document.getElementById('_post').disabled = false;
                    reject(error);
                });
        });
    }

    //ä¿®æ”¹æ–‡ç« 
    function post_2() {
        return new Promise((resolve, reject) => {
            document.getElementById('_post2').disabled = true;
            var title_ = document.getElementById("post_title").value;
            var description_ = document.getElementById("post_description").value;
            var categories_ = document.getElementById("post_categories").value.replace(/ï¼Œ/g, ',');
            var tags_ = document.getElementById("post_tag").value.replace(/ï¼Œ/g, ',');
            var pin_ = document.getElementById("zhiding").checked;
            var math_ = document.getElementById("shuxue").checked;
            var mermaid_ = document.getElementById("tubiao").checked;
            var _date = getCurrentDate(4);
            var _date2 = getCurrentDate(2);
            var _data = JSON.parse(localStorage.getItem('post_edit_data'));
            var _file_name = _data.path;
            var post_img_src = document.getElementById("post_img").value;
            var post_img_alt = document.getElementById("post_img_alt").value;
            var img_s = "";
            if (post_img_src !== "") {
                img_s = "\nimage:\n    path: " + post_img_src + "\n    lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA\n    alt: " + post_img_alt;
            }
            var post_c = editor.getMarkdown();
            var md_title_c = [
                "---\ntitle: ", title_,
                "\ndescription: ", description_,
                "\ndate: ", _data.date,
                "\ncategories: [", categories_, "]\ntags: [", tags_,
                "]\npin: ", pin_,
                "\nmath: ", math_,
                "\nmermaid: ", mermaid_,
                img_s,
                "\n---\n"
            ].join('');

            var b_content = md_title_c + "> æœ€è¿‘ä¿®æ”¹æ—¥æœŸï¼š" + _date + "  \n" + post_c;
            var base64_content = btoaUnicode(b_content);

            fetch(`https://api.github.com/repos/${owner}/${repo}/contents/_posts/${_file_name}`, {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + atoken,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    "content": base64_content,
                    "message": `ä¿®æ”¹æ–‡ç« ã€Š${_file_name}ã€‹`,
                    "committer": {
                        "name": name_,
                        "email": email_
                    },
                    "sha": _data.sha,
                }),
            })
                .then(response => {
                    switch (response.status) {
                        case 200:
                        case 201:
                            let t = ["post_title", "post_description", "post_categories", "post_tag", "post_img", "post_img_alt"];
                            for (let i = 0; i < t.length; i++) {
                                document.getElementById(t[i]).value = "";
                            }
                            document.getElementById("zhiding").checked = false;
                            document.getElementById("shuxue").checked = false;
                            document.getElementById("tubiao").checked = false;
                            editor.reset();
                            document.getElementById('_post2').disabled = false;
                            document.getElementById('_post2').style.display = "none";
                            document.getElementById('_post').style.display = "block";
                            alert("(Ùˆâ€¢Ì€ã…‚â€¢Ì)Ùˆâœ§ å‘è¡¨æˆåŠŸ ğŸ‰ğŸ‰", "success");
                            console.log("(Ùˆâ€¢Ì€ã…‚â€¢Ì)Ùˆâœ§ å‘è¡¨æˆåŠŸ ğŸ‰ğŸ‰", response.status);
                            break;
                        case 404: // Resource not found
                            alert("(;Â´à¼àº¶Ğ”à¼àº¶`) è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ‹¥æœ‰è€…å’Œä»“åº“å", "danger");
                            console.error("(;Â´à¼àº¶Ğ”à¼àº¶`) è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ‹¥æœ‰è€…å’Œä»“åº“å çŠ¶æ€ç ï¼š", response.status);
                            // å¯èƒ½éœ€è¦å¤„ç†æ‰¾ä¸åˆ°èµ„æºçš„æƒ…å†µ
                            break;
                        case 409: // Conflict - æ–‡ä»¶å†²çªï¼Œå¯èƒ½åŒæ—¶æœ‰å…¶ä»–æ›´æ–°æ“ä½œ
                            alert("Î£(â˜‰Ğ´âŠ™) å½“å‰æ–‡ä»¶åä¸githubç«¯çš„æ–‡ä»¶åå†²çª", "danger");
                            console.warn("Î£(â˜‰Ğ´âŠ™) å½“å‰æ–‡ä»¶åä¸githubç«¯çš„æ–‡ä»¶åå†²çª çŠ¶æ€ç ï¼š", response.status);
                            // å¤„ç†å†²çªé€»è¾‘
                            break;

                        case 401:
                        case 422: // Validation failed æˆ– è¢«è®¤å®šä¸ºåƒåœ¾è¯·æ±‚
                            alert("(|||ï¾ŸĞ´ï¾Ÿ) Tokenå·²ç»è¶…è¿‡githubæ¬¡æ•°é™åˆ¶ï¼Œéœ€ç­‰å¾…æ¢å¤æ¬¡æ•°", "danger");
                            console.error("(|||ï¾ŸĞ´ï¾Ÿ) Tokenå·²ç»è¶…è¿‡githubæ¬¡æ•°é™åˆ¶ï¼Œéœ€ç­‰å¾…æ¢å¤æ¬¡æ•° çŠ¶æ€ç ï¼š", response.status);
                            // éœ€è¦æ£€æŸ¥æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚æˆ–ç¨åå†è¯•
                            break;
                        default:
                            if (!response.ok) {
                                alert(`(â” â—Ÿ;ï¾ŸĞ´ï¾Ÿ)ãƒ æœªçŸ¥é”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š${response.status}`, "danger");
                                throw new Error(`(â” â—Ÿ;ï¾ŸĞ´ï¾Ÿ)ãƒ æœªçŸ¥é”™è¯¯ï¼ŒçŠ¶æ€ç  ${response.status}`);
                            }
                    }
                    document.getElementById('_post2').disabled = false;
                    resolve();
                })
                .catch(error => {
                    alert("ï½¡ï¾Ÿãƒ½(ï¾ŸÂ´Ğ”`)ï¾‰ï¾Ÿï½¡ è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥Token", "danger");
                    console.error('ï½¡ï¾Ÿãƒ½(ï¾ŸÂ´Ğ”`)ï¾‰ï¾Ÿï½¡ è¯·æ±‚é“¾æ¥å‡ºé”™ï¼Œè¯·æ£€æŸ¥Token ', error);
                    document.getElementById('_post2').disabled = false;
                    reject(error);
                });
        });
    }

    function change_home() {
        if (document.getElementById("owner_").value == "") {
            document.getElementById("no_set").style.display = "flex";
            document.getElementById("post_box").style.display = "none";
            document.getElementById("ptext").innerText = 'âš ï¸è¿˜æœªè®¾ç½®æ‹¥æœ‰è€… ';
        } else
            if (document.getElementById("repo_").value == "") {
                document.getElementById("no_set").style.display = "flex";
                document.getElementById("post_box").style.display = "none";
                document.getElementById("ptext").innerText = 'âš ï¸è¿˜æœªè®¾ç½®ä»“åº“å ';
            } else
                if (document.getElementById("name_").value == "") {
                    document.getElementById("no_set").style.display = "flex";
                    document.getElementById("post_box").style.display = "none";
                    document.getElementById("ptext").innerText = 'âš ï¸è¿˜æœªè®¾ç½®æäº¤è€… ';
                } else
                    if (document.getElementById("email_").value == "") {
                        document.getElementById("no_set").style.display = "flex";
                        document.getElementById("post_box").style.display = "none";
                        document.getElementById("ptext").innerText = 'âš ï¸è¿˜æœªè®¾ç½®é‚®ç®± ';
                    } else
                        if (document.getElementById("accessTokenInput").value == "") {
                            document.getElementById("no_set").style.display = "flex";
                            document.getElementById("post_box").style.display = "none";
                            document.getElementById("ptext").innerText = 'âš ï¸è¿˜æœªè®¾ç½®Token ';
                        } else
                            if (document.getElementById("owner_").value !== "" && document.getElementById("repo_").value !== "" && document.getElementById("accessTokenInput").value !== "") {
                                document.getElementById("no_set").style.display = "none";
                                document.getElementById("post_box").style.display = "flex";
                            }



    }
    function decodeBase64(base64) {
        // è§£ç Base64å­—ç¬¦ä¸²
        const binaryString = window.atob(base64);
        // åˆ›å»ºä¸€ä¸ªArrayBufferè§†å›¾
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        // å°†è§£ç åçš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºUint8Array
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        // åˆ›å»ºä¸€ä¸ªTextDecoderå®ä¾‹æ¥å¤„ç†UTF-8ç¼–ç 
        const decoder = new TextDecoder('utf-8');
        // è¿”å›UTF-8è§£ç åçš„å­—ç¬¦ä¸²
        return decoder.decode(bytes);
    }

    // ç¼–è¾‘æ–‡ç« 
    async function geteditpost(path, sha, title) {
        if (title == " ") {
            title = "";
        }
        try {
            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/_posts/${path}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${atoken}`,
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: `ç¼–è¾‘æ–‡ç« ã€Š${title}ã€‹`,
                    committer: {
                        name: name_,
                        email: email_
                    },
                    sha: sha,
                })
            });

            if (!response.ok) {
                throw new Error(`${response.status}`);
            }

            return await response.json();
        } catch (error) {
            console.error('åˆ é™¤å‡ºé”™:', error);
            throw error;
        }
    }

    async function edit_post(node) {
        // console.log(pnode.getAttribute('data-sha'))
        node.style.display = 'none';
        add_loading(node.parentNode);
        let pnode = node.parentNode.parentNode
        try {
            const dlist = await get_info(pnode.getAttribute('data-url'));
            // console.log(decodeBase64(dlist.content));
            new bootstrap.Tab(document.querySelector('#w_blog-tab')).show();
            let datac = decodeBase64(dlist.content);
            var setdict = {};
            var strlist = datac.match(/^---\n(.*?)\n---/s)[0].split('\n');
            for (let i = 0; i < strlist.length; i++) {
                if (strlist[i] !== "---") {
                    let item = strlist[i].trimStart();
                    var items = item.split(": ");
                    if (items.length == 2) {
                        setdict[items[0]] = items[1];
                    }

                }
            }
            // console.log(setdict)

            // console.log(content);
            // console.log(JSON.stringify(setdict, null, 2));
            document.getElementById("post_title").value = setdict.title;
            if (setdict.description !== "") { document.getElementById("post_description").value = setdict.description; };
            if (setdict.categories !== "") { document.getElementById("post_categories").value = setdict.categories.slice(1, -1); };
            if (setdict.tags !== "") { document.getElementById("post_tag").value = setdict.tags.slice(1, -1); };
            if (setdict.path !== undefined && setdict.path !== "") { document.getElementById("post_img").value = setdict.path; };
            if (setdict.alt !== undefined && setdict.alt !== "") { document.getElementById("post_img").value = setdict.alt; };
            if (setdict.pin == "true") { document.getElementById("zhiding").checked = true; } else { document.getElementById("zhiding").checked = false; };
            if (setdict.math == "true") { document.getElementById("shuxue").checked = true; } else { document.getElementById("shuxue").checked = false; };
            if (setdict.mermaid == "true") { document.getElementById("tubiao").checked = true; } else { document.getElementById("tubiao").checked = false; };
            let content = datac.replace(/---[\s\S]*---[\r\n]*/g, '');
            editor.setMarkdown(content);

            document.getElementById("_post").style.display = "none";
            document.getElementById("_post2").style.display = "block";


            let dataItems = strlist.filter(item => item.indexOf('date') === 0);

            let ped = {
                "sha": pnode.getAttribute('data-sha'),
                "path": pnode.getAttribute('data-path'),
                "date": dataItems[0].split(": ")[1],
            }
            localStorage.setItem('post_edit_data', JSON.stringify(ped));














        } catch (err) {
            console.error(`ç¼–è¾‘æ–‡ç« æ—¶å€™è¯·æ±‚å¤±è´¥ `, err);
        }
        node.style.display = 'block';
        del_loading(node.parentNode);

    }

    // å°è£… DELETE è¯·æ±‚åˆ° GitHub çš„å‡½æ•°
    async function deleteFileFromGitHub(path, sha, title) {
        if (title == " ") {
            title = "";
        }
        try {
            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/_posts/${path}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `token ${atoken}`,
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: `åˆ é™¤æ–‡ç« ã€Š${title}ã€‹`,
                    committer: {
                        name: name_,
                        email: email_
                    },
                    sha: sha,
                })
            });

            if (!response.ok) {
                throw new Error(`${response.status}`);
            }

            return await response.json();
        } catch (error) {
            console.error('åˆ é™¤å‡ºé”™:', error);
            throw error;
        }
    }


    function delete_post(node) {
        document.getElementById("del_msbox").style.display = 'flex';
        setTimeout(function () {
            document.getElementById("del_msbox").style.opacity = '1';
            document.getElementById("del_msbox2").style.bottom = '0';
        }, 120)
        document.getElementById('e_del').addEventListener('click', async function () {
            document.getElementById("del_msbox").style.opacity = '0';
            document.getElementById("del_msbox2").style.bottom = '100%';
            setTimeout(function () {
                document.getElementById("del_msbox").style.display = 'none';
            }, 800)
            node.style.display = 'none';
            add_loading(node.parentNode);
            let ppnode = node.parentNode.parentNode;
            let sha = ppnode.getAttribute('data-sha');
            let path = ppnode.getAttribute('data-path');
            let title = ppnode.getAttribute('data-title');

            try {
                const result = await deleteFileFromGitHub(path, sha, title);
                console.log(result)
                // console.log('åˆ é™¤å®Œæˆ');
                re_postlists_box();
                // return result;
            } catch (error) {
                alert("åˆ é™¤æ–‡ç« å¤±è´¥ï¼Œè¯¦æƒ…çœ‹æ§åˆ¶å°è¾“å‡º", "danger");
                if (error == "Error: 404") {
                    console.error("çŸ­æ—¶é—´å†…åˆ é™¤å¤ªé¢‘ç¹äº†ï¼å®é™…æ–‡ç« å·²ç»åˆ é™¤ï¼Œéœ€ç­‰å¾…githubçš„actionsæ‰§è¡Œå®Œæ¯•ï¼Œé‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨")
                }

                node.style.display = 'block';
                del_loading(node.parentNode);
                throw error;
            }

        });

        document.getElementById('e_del').removeEventListener('click', arguments.callee);//å–æ¶ˆç›‘å¬ç‚¹å‡»äº‹ä»¶é¿å…é‡å¤è§¦å‘




    }


    //é€Ÿç‡æ˜¾ç¤º
    function sl() {
        let box = document.getElementById("sulv");
        let tokne = document.getElementById("accessTokenInput").value;
        let head = {};
        if (tokne !== "") {
            head = {
                'Authorization': `token ${tokne}`
            }
        }
        box.innerHTML = '';
        add_loading(box);
        fetch('https://api.github.com/rate_limit', {
            headers: head
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // console.log(data);
                let zsl = data.rate.limit;
                let sysl = data.rate.remaining;
                let percentage = Math.round((sysl / zsl) * 100);
                const date = new Date(data.rate.reset * 1000);
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                const seconds = date.getSeconds().toString().padStart(2, '0');
                const formattedDateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                const ibox = `
                <div class="progress mb-1" role="progressbar" aria-valuemin="0" aria-valuemax="100"style="width: 100%;">
                    <div class="progress-bar" style="width: ${percentage}%;">${sysl}</div>
                </div>
                <span style="font-size: 0.5rem;">æ€»é€Ÿç‡ ${zsl} é‡ç½®æ—¶é—´æ—¥æœŸ ${formattedDateTime}</span><span class="edit_btn border rounded p-1 m-1" style="cursor: pointer;font-size: 0.8rem;" onclick="sl()">â™»ï¸</span>
                `;
                document.getElementById('sulv').insertAdjacentHTML('beforeend', ibox);
                del_loading(box);
            })
            .catch(error => {
                console.error('Error:', error);
                del_loading(box);
            });
    }
</script>


<script>

    ready(function () {
        window.onbeforeunload = function (e) {
            return 'ç¡®å®šç¦»å¼€æ­¤é¡µå—ï¼Ÿ';
        }
        console.info('%c Author %c' + ' Zeb', 'background:#70a1d7;color:#ffffff;border-radius: 2px;', 'color:auto;');
        console.info('%c Alert %c' + '  ( Â´â—” â€¸â—”`) ä½ æ˜¯æƒ³çœ‹æˆ‘çš„å±å±±ä»£ç å—ï¼Ÿ', 'background:#a1de93;color:#ffffff;border-radius: 2px;', 'color:auto;');
        console.info('%c Alert %c' + '  ( â€¾Ê–Ì«â€¾) è¦ä¸å»Githubç§ç§ï¼Ÿ', 'background:#f7f48b;color:#ffffff;border-radius: 2px;', 'color:auto;')
        console.info('%c Alert %c' + '  à­§(à¹‘â€¢Ì€âŒ„â€¢Ìà¹‘)à«­ é¡ºä¾¿ç»™æˆ‘ä¸ªâ­ï¸Staré¸­~', 'background:#f47c7c;color:#ffffff;border-radius: 2px;', 'color:auto;')
        let cfg = get_config();
        change_ui(cfg);
        owner = cfg.sz.yyz;
        repo = cfg.sz.cangku;
        name_ = cfg.sz.tjz;
        email_ = cfg.sz.email;
        img_path = cfg.sz.lujing;
        atoken = cfg.sz.token;

        if (cfg.sz.img_cdn == "") {
            imgcdn = "https://raw.githubusercontent.com";
        } else {
            imgcdn = cfg.sz.img_cdn;
        }



        changestyle(); //æ‹–æ‹½æ–‡ä»¶æ›´æ–°æ ·å¼

        get_name_repo(); //å®æ—¶æ›´æ–°è®¾ç½®é¡µé¢æ‹¥æœ‰è€…å’Œä»“åº“åçš„æ ‡ç­¾

        check_preview(); //åˆå§‹åŒ–å›¾ç‰‡é¢„è§ˆæ¡†

        change_home(); //åˆå§‹åŒ–ä¸»é¡µæ˜¯å¦è®¾ç½®äº†ç”¨æˆ·ä¿¡æ¯

        change_post(); //åˆå§‹åŒ–æ–‡ç« ä¿å­˜å†…å®¹

        change_post_list(); //åˆå§‹åŒ–æ–‡ç« å†…å®¹

        sl();//è·å–tokené€Ÿç‡






        document.getElementById("owner_").addEventListener('change', get_name_repo);
        document.getElementById("repo_").addEventListener('change', get_name_repo);

        // è§¦å‘ å‘å¸ƒæŒ‰é’®

        document.getElementById('_post').addEventListener('click', function () {
            // alert('ç‚¹å‡»äº†å‘è¡¨', 'success');
            let post_t = document.getElementById("post_title").value;
            let post_c = editor.getMarkdown();
            if (post_t == "") {
                alert("æ–‡ç« æ ‡é¢˜ä¸èƒ½ä¸ºç©º", "warning");
            } else if (post_c == "") {
                alert("æ–‡ç« å†…å®¹ä¸èƒ½ä¸ºç©º", "warning");
            } else {
                document.getElementById("post_msbox").style.display = 'flex';
                setTimeout(function () {
                    document.getElementById("post_msbox").style.opacity = '1';
                    document.getElementById("post_msbox2").style.bottom = '0';
                }, 120)

            }

        });

        // è§¦å‘ å‘å¸ƒä¿®æ”¹æŒ‰é’®
        document.getElementById('_post2').addEventListener('click', function () {
            // alert('ç‚¹å‡»äº†å‘è¡¨', 'success');
            let post_t = document.getElementById("post_title").value;
            let post_c = editor.getMarkdown();
            if (post_t == "") {
                alert("æ–‡ç« æ ‡é¢˜ä¸èƒ½ä¸ºç©º", "warning");
            } else if (post_c == "") {
                alert("æ–‡ç« å†…å®¹ä¸èƒ½ä¸ºç©º", "warning");
            } else {
                document.getElementById("post_msbox").style.display = 'flex';
                setTimeout(function () {
                    document.getElementById("post_msbox").style.opacity = '1';
                    document.getElementById("post_msbox2").style.bottom = '0';
                }, 120)

            }

        });





        // è§¦å‘ ä¸»é¡µè·³è½¬åˆ°è®¾ç½®é¡µé¢çš„æŒ‰é’®
        if (document.querySelector('#set_info')) {
            document.querySelector('#set_info').addEventListener('click', function (event) {
                new bootstrap.Tab(document.querySelector('#settings-tab')).show();
            });
        } else {
            alert('æ— æ³•è·å–è®¾ç½®ä¿¡æ¯æŒ‰é’®', 'warning')
        }


        // ç‚¹å‡» ä¸»é¡µ-æ ‡ç­¾é¡µ è§¦å‘äº‹ä»¶
        document.querySelector('#home-tab').addEventListener('show.bs.tab', function (event) {
            // alert('ç‚¹å‡»äº†ä¸»é¡µ', 'success')
            change_home();
        });

        // ç‚¹å‡» å†™æ–‡ç« -æ ‡ç­¾é¡µ è§¦å‘äº‹ä»¶
        document.querySelector('#w_blog-tab').addEventListener('show.bs.tab', function (event) {
            // alert('ç‚¹å‡»äº†å†™æ–‡ç« ', 'success');

        });

        // ç‚¹å‡» è®¾ç½®-æ ‡ç­¾é¡µ è§¦å‘äº‹ä»¶
        document.querySelector('#settings-tab').addEventListener('show.bs.tab', function (event) {
            // alert('ç‚¹å‡»äº†è®¾ç½®', 'success')
        });


        // è§¦å‘ è®¾ç½®-æ ‡ç­¾é¡µ æ˜¾ç¤º/éšè—tokenå€¼çš„äº‹ä»¶
        document.getElementById('show_hide').addEventListener('click', function () {
            var passwordInput = document.getElementById('accessTokenInput');
            var currentType = passwordInput.getAttribute('type');
            var newType = currentType === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', newType);

            // å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ”¹å˜æŒ‰é’®æ–‡æœ¬ä»¥æŒ‡ç¤ºå½“å‰çŠ¶æ€
            this.textContent = newType === 'password' ? 'æ˜¾ç¤º' : 'éšè—';
        });

        // è®¾ç½®-æ ‡ç­¾é¡µ ä¿å­˜æŒ‰é’®çš„è§¦å‘äº‹ä»¶
        document.getElementById('save_info').addEventListener('click', function () {
            if (document.getElementById("owner_").value == "") {
                alert("æ‹¥æœ‰è€…ä¸èƒ½ä¸ºç©º", "warning");
            } else if (document.getElementById("repo_").value == "") {
                alert("ä»“åº“åä¸èƒ½ä¸ºç©º", "warning");
            } else if (document.getElementById("name_").value == "") {
                alert("æäº¤è€…ä¸èƒ½ä¸ºç©º", "warning")
            } else if (document.getElementById("email_").value == "") {
                alert("é‚®ç®±ä¸èƒ½ä¸ºç©º", "warning")
            } else if (document.getElementById("accessTokenInput").value == "") {
                alert("Tokenä¸èƒ½ä¸ºç©º", "warning");
            } else {
                let cfg = get_config();
                cfg.sz.yyz = document.getElementById("owner_").value;
                cfg.sz.cangku = document.getElementById("repo_").value;
                cfg.sz.tjz = document.getElementById("name_").value;
                cfg.sz.email = document.getElementById("email_").value;
                cfg.sz.token = document.getElementById("accessTokenInput").value;
                cfg.sz.img_cdn = document.getElementById("img_cdn").value;
                cfg.sz.lujing = document.getElementById("img_set_box_").value;
                set_config(cfg);
                owner = document.getElementById("owner_").value;
                repo = document.getElementById("repo_").value;
                name_ = document.getElementById("name_").value;
                email_ = document.getElementById("email_").value;
                atoken = document.getElementById("accessTokenInput").value;
                imgcdn = document.getElementById("img_cdn").value;
                img_path = document.getElementById("img_set_box_").value;


                //    è·³è½¬ä¸»é¡µ
                new bootstrap.Tab(document.querySelector('#home-tab')).show();

            }



        })





        // ç»‘å®šå›¾åºŠæ å¼€å…³
        var tc_switch_btn = document.getElementById("tuchuang")
        tc_switch_btn.addEventListener('change', function () {
            checktuchuangstatus(tc_switch_btn, document.getElementById("tuchuang_box"));
        });
        checktuchuangstatus(tc_switch_btn, document.getElementById("tuchuang_box"));



        //ç»‘å®šå›¾åºŠåˆ·æ–°æŒ‰é’®
        document.getElementById("update_img").addEventListener('click', updateimgdata);
        document.getElementById("uploadimg").addEventListener('click', get_img_list);

        //æœ¬åœ°å­˜å‚¨åŠ è½½æœ€è¿‘ä¸Šä¼ å›¾ç‰‡
        load_recent_img();




        document.getElementById('c_post').addEventListener('click', function () {
            document.getElementById("post_msbox").style.opacity = '0';
            document.getElementById("post_msbox2").style.bottom = '100%';
            setTimeout(function () {
                document.getElementById("post_msbox").style.display = 'none';
            }, 800)


        })
        document.getElementById('e_post').addEventListener('click', function () {
            if (document.getElementById("_post").style.display !== "none") {
                post_();
            } else {
                post_2();
            }
            document.getElementById("post_msbox").style.opacity = '0';
            document.getElementById("post_msbox2").style.bottom = '100%';
            setTimeout(function () {
                document.getElementById("post_msbox").style.display = 'none';
            }, 1000)
        })

        document.getElementById('c_del').addEventListener('click', function () {
            document.getElementById("del_msbox").style.opacity = '0';
            document.getElementById("del_msbox2").style.bottom = '100%';
            setTimeout(function () {
                document.getElementById("del_msbox").style.display = 'none';
            }, 800)


        })

        document.getElementById('load_post').addEventListener('click', function () {
            // console.log("ç‚¹å‡»åŠ è½½æ–‡ç« ");
            re_postlists_box()
        })



        document.getElementById('zhiding').addEventListener('change', function () {
            let checked_ = document.getElementById('zhiding').checked;
            let cfg = JSON.parse(localStorage.getItem('post_data'));
            cfg.pz = checked_;
            localStorage.setItem('post_data', JSON.stringify(cfg));
        });
        document.getElementById('shuxue').addEventListener('change', function () {
            let checked_ = document.getElementById('shuxue').checked;
            let cfg = JSON.parse(localStorage.getItem('post_data'));
            cfg.ps = checked_;
            localStorage.setItem('post_data', JSON.stringify(cfg));
        });
        document.getElementById('tubiao').addEventListener('change', function () {
            let checked_ = document.getElementById('tubiao').checked;
            let cfg = JSON.parse(localStorage.getItem('post_data'));
            cfg.ptb = checked_;
            localStorage.setItem('post_data', JSON.stringify(cfg));
        });





















    });


</script>


<script>
    const { Editor } = toastui;
    const { codeSyntaxHighlight } = Editor.plugin;
    const { colorSyntax } = Editor.plugin;

    const autosave_btn = document.createElement('div');
    autosave_btn.className = 'form-check form-switch m-0 p-0 d-flex align-items-center justify-content-center';
    autosave_btn.style = 'width:100px';

    const autosave_input = document.createElement('input');
    autosave_input.className = 'form-check-input m-0';
    autosave_input.type = 'checkbox';
    autosave_input.role = 'switch';
    autosave_input.id = 'auto_save';
    autosave_input.checked = false;

    //è‡ªåŠ¨ä¿å­˜æ–‡ç« 
    var intervalId = null; // åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰intervalId
    function checkAutoSaveStatus() {
        var cfg = get_config();
        if (autosave_input.checked) {
            if (intervalId === null) { // ç¡®ä¿ä¸ä¼šé‡å¤è®¾ç½®å®šæ—¶å™¨
                // console.log("è‡ªåŠ¨ä¿å­˜å·²å¼€å¯");   
                cfg.zdbc = true;

                let pt = document.getElementById("post_title").value;
                let pd = document.getElementById("post_description").value;
                let pc = document.getElementById("post_categories").value;
                let ptag = document.getElementById("post_tag").value;
                let pi = document.getElementById("post_img").value;
                let pia = document.getElementById("post_img_alt").value;
                let pz = document.getElementById("zhiding").checked;
                let ps = document.getElementById("shuxue").checked;
                let ptb = document.getElementById("tubiao").checked;

                let post_data = {
                    "pt": pt,
                    "pd": pd,
                    "pc": pc,
                    "ptag": ptag,
                    "pi": pi,
                    "pia": pia,
                    "pz": pz,
                    "ps": ps,
                    "ptb": ptb
                }

                localStorage.setItem('post_data', JSON.stringify(post_data));
                localStorage.setItem('contents', JSON.stringify(editor.getMarkdown()));
                intervalId = setInterval(function () {
                    localStorage.setItem('post_data', JSON.stringify(post_data));
                    localStorage.setItem('contents', JSON.stringify(editor.getMarkdown()));
                    // console.log(editor.getMarkdown());
                }, 120000);
            }
        } else {
            clearInterval(intervalId); // å…³é—­è‡ªåŠ¨ä¿å­˜æ—¶æ¸…é™¤å®šæ—¶å™¨
            intervalId = null; // é‡ç½®intervalId
            localStorage.removeItem('contents');
            localStorage.removeItem('post_data');
            cfg.zdbc = false;
        }
        set_config(cfg);
    }
    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ä»¥åœ¨checkboxçŠ¶æ€æ”¹å˜æ—¶è°ƒç”¨checkAutoSaveStatus
    autosave_input.addEventListener('change', checkAutoSaveStatus);



    const autosave_label = document.createElement('label');
    autosave_label.className = 'form-check-label ms-1';
    autosave_label.htmlFor = 'auto_save';
    autosave_label.textContent = 'è‡ªåŠ¨ä¿å­˜';
    autosave_label.style = 'font-size: 0.8rem;'


    autosave_btn.appendChild(autosave_input);
    autosave_btn.appendChild(autosave_label);

    const tuchuang_switch = document.getElementById("tuchuang");



    const editor = new Editor({
        el: document.querySelector('#editor'),
        initialEditType: 'markdown',
        previewStyle: 'tab',
        height: '100%',
        language: 'zh-CN',
        toolbarItems: [
            ['heading', 'bold', 'italic', 'strike'],
            ['hr', 'quote'],
            // ['ul', 'ol', 'task', 'indent', 'outdent'],
            ['ul', 'ol', 'task',],
            ['table', 'image', 'link'],
            ['code', 'codeblock'],
            ['scrollSync'],
            [{
                name: 'as',
                tooltip: 'è‡ªåŠ¨ä¿å­˜',
                className: 'toastui-editor-toolbar-icons',
                el: autosave_btn,
                style: { backgroundImage: '' }
            }],
        ],
        plugins: [codeSyntaxHighlight, colorSyntax],
        theme: '', //dark

    });

    const alertPlaceholder = document.getElementById('liveAlertPlaceholder')

    // è“è‰²ï¼šprimary  ç™½ç°è‰²ï¼šsecondary  ç»¿è‰²ï¼šsuccess  çº¢è‰²ï¼šdanger  é»„è‰²ï¼šwarning  å¤©è“è‰²ï¼šinfo ç™½è‰²ï¼šlight  é»‘è‰²ï¼šdark
    const alert = (message, type) => {
        const wrapper = document.createElement('div')
        wrapper.innerHTML = [
            `<div class="alert alert-${type} alert-dismissible text-center show fade" role="alert" >`,
            `   <div>${message}</div>`,
            '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" ></button>',
            '</div>'
        ].join('')

        alertPlaceholder.append(wrapper)
    }




</script>


</html>
